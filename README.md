# Агент очереди печати с Telegram-ботом

Интеллектуальный агент для автоматизации процесса формирования очереди печати на производстве. Система интегрируется с Microsoft OneDrive, обрабатывает неструктурированные описания заказов с помощью Claude 3.5 Haiku, формирует и управляет очередью печати на основании сроков и приоритетов. Взаимодействие с пользователями осуществляется через Telegram-бота.

## Основные возможности

- Подключение к Microsoft OneDrive через Microsoft Graph API
- Обработка неструктурированных описаний заказов с помощью Claude 3.5 Haiku
- Формирование очереди печати на основе сроков и приоритетов
- Редактирование Excel-файлов, хранящихся в облаке
- Взаимодействие с пользователями через Telegram-бота
- Отправка уведомлений о новых и срочных заказах через Telegram

## Архитектура

Проект разделен на следующие модули:

1. **main.py**: Основной модуль, объединяющий все компоненты
2. **onedrive_integration.py**: Интеграция с OneDrive через Microsoft Graph API
3. **data_processing.py**: Обработка неструктурированных описаний заказов с помощью Claude 3.5 Haiku
4. **queue_formation.py**: Логика формирования и обновления очереди печати
5. **excel_editing.py**: Чтение и запись Excel-файлов
6. **telegram_bot.py**: Взаимодействие с пользователями через Telegram API

## Установка

### Требования

- Python 3.8 или выше
- Зарегистрированное приложение в Microsoft Azure для доступа к Microsoft Graph API
- API-ключ для языковой модели (Claude API или OpenAI API)

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка конфигурации

1. Скопируйте `.env.example` в `.env` и заполните необходимые переменные окружения:

```
AZURE_APP_ID=ваш_app_id
AZURE_APP_SECRET=ваш_app_secret
AZURE_TENANT_ID=ваш_tenant_id
CLAUDE_API_KEY=ваш_claude_api_key
TELEGRAM_BOT_TOKEN=ваш_telegram_token
```

2. Настройте `config.yaml` в соответствии с вашими требованиями, особо обратите внимание на раздел `telegram` с настройками бота.

## Использование

### Запуск Telegram-бота

Для запуска бота и обработки очереди выполните:

```bash
python main.py
```

### Дополнительные команды управления

Однократная обработка очереди без запуска бота:
```bash
python main.py --run-once
```

Скачивание файлов из OneDrive:
```bash
python main.py --download-files
```

Загрузка файлов в OneDrive:
```bash
python main.py --upload-files
```

Формирование отчета об очереди:
```bash
python main.py --report
```

### Команды Telegram-бота

После запуска бота доступны следующие команды:

- `/start` - начало работы с ботом и приветственное сообщение
- `/help` - показать справку по использованию бота
- `/new_order` - создать новый заказ на печать
- `/status` - получить информацию о текущей очереди печати

Только для администраторов:

- `/update_queue` - обновить очередь вручную
- `/change_status` - изменить статус заказа

## Структура проекта

```
.
├── .env                     # Переменные окружения
├── config.yaml              # Конфигурация приложения
├── main.py                  # Основной модуль
├── onedrive_integration.py  # Интеграция с OneDrive
├── data_processing.py       # Обработка данных с помощью LLM
├── queue_formation.py       # Формирование очереди
├── excel_editing.py         # Работа с Excel-файлами
├── user_interface.py        # Веб-интерфейс
├── notifications.py         # Отправка уведомлений
├── requirements.txt         # Зависимости
├── logs/                    # Директория для логов
└── data/                    # Директория для данных
    └── notifications/       # История уведомлений
```

## Дополнительная информация

### Обработка заказов

Агент обрабатывает неструктурированные описания заказов с помощью языковой модели и выделяет ключевую информацию:
- Номер заказа
- Заказчик
- Срок выполнения
- Количество
- Приоритет
- Описание заказа

### Формирование очереди

Очередь формируется на основе следующих критериев:
- Срок выполнения (дедлайн)
- Приоритет заказа
- Время поступления заказа

### Уведомления

Система отправляет следующие типы уведомлений:
- Срочные заказы с близким сроком выполнения
- Проблемные заказы с неполной информацией
- Ежедневные отчеты о состоянии очереди
